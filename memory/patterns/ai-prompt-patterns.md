# AI 프롬프트 작성 패턴

## 핵심 원칙: 데이터 전처리 > 프롬프트 지시

gpt-5-nano(및 소형 모델)에서 확인된 패턴:
- **프롬프트로 변환 시키면 실패**: "UTC를 KST로 변환하라" → AI가 못 따름
- **전처리된 값을 주면 성공**: 이미 "2026-02-08 23:47"로 변환된 값은 그대로 출력
- **결론**: AI에게 계산/변환을 시키지 말고, 백엔드에서 미리 처리한 데이터를 제공

### 적용 예시
```python
# BAD: AI에게 변환 시킴
"opened_at": "2026-02-08T14:47:50+00:00"  # AI가 KST 변환 실패

# GOOD: 백엔드에서 전처리
"opened_at": "2026-02-08 23:47"  # AI가 그대로 사용
"average_buy_price": "839,000원"  # 콤마 포맷 완료
"holding_period": "1일 6시간"  # 계산 완료
"status": "진행중"  # 한글 변환 완료
```

## gpt-5-nano 모델 한계

| 지시 유형 | 준수 여부 | 대안 |
|-----------|----------|------|
| 6-7섹션 구조 | ✅ 잘 지킴 | - |
| 테이블 헤더/구분선 | ✅ 잘 지킴 | - |
| 메타 설명 금지 | ❌ 반복 삽입 | "절대 금지" + 구체적 예시 나열로 감소 |
| 복잡 테이블 (3+컬럼) | △ 불안정 | 2컬럼은 잘 지킴, 4컬럼은 전처리 데이터로 해결 |
| UTC→KST 변환 | ❌ 못 따름 | 백엔드 전처리로 해결 |
| 세션별 분리 | △ 운용보고서는 OK, 의사결정서는 불안정 | - |
| 데이터 무결성 | ✅ 잘 지킴 | - |
| JSON 구조 (response_format) | ✅ 강제됨 | - |

## 프롬프트 구조 패턴

### 시스템 프롬프트
```
1. 절대 금지 (위반 시 실패) - 구체적 예시 나열
2. 핵심 원칙 5-7개 - 데이터 무결성, 숫자 정확성, 형식 준수
3. 작성 스타일 - 간결한 문장, 마크다운 테이블, 시간순
```

### 사용자 프롬프트
```
1. 데이터 블록 (JSON) - 이미 전처리된 값
2. 형식 지정 - 각 섹션의 예시 테이블 제시
3. 조건부 처리 - "데이터가 없으면 X 표시"
```

### 반복 개선 사이클
```
Iter 0: 현재 프롬프트 → AI 결과 기록
Iter 1: 문제점 식별 → 프롬프트 수정 → 비교
Iter 2: 잔여 문제 → 추가 수정 or 백엔드 전처리
종료 조건: 모델 한계에 도달 / 개선점 미미
```

## Docker 주의사항
- `docker-compose restart`: 코드 변경 반영 안 될 수 있음
- `docker-compose up -d --build`: 확실한 코드 반영
- 코드 변경 후 반드시 `up --build` 사용
