# 현재 세션 상태
> 마지막 업데이트: 2026-02-12 (Iter 4 완료)

## 개발 환경
- **로컬 개발** (Docker 사용) - 클라우드타입 배포 중단됨
- 프론트엔드: React + Vite (localhost:80 via Docker nginx)
- 백엔드: FastAPI (localhost:8000)
- DB: PostgreSQL (Docker 컨테이너)
- docker-compose.yml에 `env_file: ./backend/.env` 추가됨 (NAVER/OPENAI 키 전달)

## AI 프롬프트 엔지니어링 진행 상황

### Iteration 요약 테이블

| 문서 | Iter 0 | Iter 1 | Iter 2 | Iter 3b | **Iter 4** |
|------|--------|--------|--------|---------|------------|
| 칼럼 avg | 1,342 (64%) | 1,558 (74%) | 1,667 (79%) | ~1,585 (75%) | **1,770 (84%)** |
| 카드 avg | 589 (71%) | 638 (77%) | 679 (82%) | ~689 (83%) | **755 (92%)** |
| 종목 avg | 700 (82%) | 584 (69%) | 711 (84%) | ~719 (85%) | **822 (97%)** |

### Iter 4 (완료 2026-02-12) — 근본적 개선
- **변경사항**:
  1. `max_output_tokens=32768` 명시 (Responses API + Chat Completions)
  2. `reasoning={"effort": "medium"}` (추론 토큰 절약)
  3. 글자수 목표 → 문단/문장 수 목표 전환
  4. Few-shot 칼럼 예시 1개 추가 (~2,500자)
  5. "JSON만 출력하세요" → 반절단 지시로 변경
  6. QUALITY_CHECKLIST 문단/문장 기반 + 출력 피로 대응 항목
- **결과 (2회 테스트)**:
  - Run 1: 칼럼 1,789 (85%), 카드 730 (88%), 종목 765 (90%)
  - Run 2: 칼럼 1,750 (83%), 카드 780 (95%), 종목 878 (103%)
- **핵심 관찰**:
  - 카드/종목 90%+ 달성!
  - 국내 칼럼은 2,099~2,125자로 이상적 수준이지만 해외 칼럼 1,375~1,479자가 병목
  - 해외 뉴스 소스 부족 (yfinance 30건 vs naver 727건)이 원인일 수 있음
  - 변동성 감소: Iter 3b(1,409~1,760) → Iter 4(1,750~1,789)
  - 출력 피로 감소: 뒤쪽 카드도 양호

### 의사결정서 verbosity 분리 (완료)
- `_call_ai()` verbosity 파라미터 추가
- 의사결정서: medium / 운용보고서: high (기본값)

## 크롤링 현황 (2026-02-12 테스트)
- 네이버: 2/11 224건 + 2/12 503건 = 727건 정상
- yfinance: 30건
- 총 757건 수집 → AI 입력 50건 (상위)

## 최근 완료 작업
- [x] 🔵 [개선] Iter 4 구현 + 테스트 (2026-02-12)
- [x] ⚙️ [설정] docker-compose.yml env_file 추가 (2026-02-12)
- [x] 🔵 [리서치] 뉴스데스크 프롬프트 종합 진단 (2026-02-12)

## 알려진 이슈
- JSON 키 불일치: stock_name vs name (프론트엔드 매핑 확인 필요)
- 해외 칼럼 길이 부족: yfinance 뉴스 30건으로는 깊이 있는 분석이 어려움

## 다음 할 일
- 해외 칼럼 개선 방안 (해외 뉴스 소스 확충 or 해외 칼럼 특화 프롬프트)
- 분할 생성 여부 재검토 (현재 카드/종목 90%+ 달성으로 칼럼만 미달)
